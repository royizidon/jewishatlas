<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jewish Atlas</title>

  <!-- ArcGIS CSS -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
  <!-- ArcGIS JS -->
  <script src="https://js.arcgis.com/4.26/"></script>
  <!-- Load confidential config (defines LANDMARKS_URL) -->
  <script src="config.js"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    html, body { margin: 0; padding: 0; height: 100%; font-family: 'Helvetica Neue', sans-serif; overflow: hidden; }
    #appHeader {
      position: fixed; top: 0; left: 0; right: 0; margin: 0 auto; max-width: 1200px;
      height: 50px; background: #fff; border-bottom: 1px solid #ddd;
      display: flex; align-items: center; justify-content: center; z-index: 1000;
    }
    #filterContainer { position: fixed; top: 50px; left: 0; width: 100%; background: #fff; padding: 8px 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; gap: 8px; overflow-x: auto;
      white-space: nowrap; z-index: 1000;
    }
    .filterBtn { padding: 6px 14px; border: 2px solid #ccc; border-radius: 20px; background: #fff;
      font-size: 14px; cursor: pointer; color: #555; transition: 0.15s; white-space: nowrap;
    }
    .filterBtn.active { background: #555; border-color: #555; color: #fff; }
    #viewDiv { position: absolute; top: 94px; left: 0; right: 0; bottom: 0; }
    #welcomeModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 2000;
    }
    .modal-content { background: #fff; padding: 30px; border-radius: 14px; max-width: 400px; text-align: center; }
    .modal-buttons { display: flex; gap: 12px; justify-content: center; margin-top: 20px; }
    .start-button, .upload-button { flex: 1; padding: 12px; font-size: 16px; border: none;
      border-radius: 30px; color: #fff; cursor: pointer;
    }
    .start-button { background: #2D66F4; }
    .upload-button { background: #F57C00; }
    /* Override ArcGIS Zoom icon size */
    .esri-widget--zoom .esri-icon-plus, .esri-widget--zoom .esri-icon-minus {
      font-size: 22px !important;
    }
    /* Custom widget button */
    .custom-button {
      background: #fff; border-radius: 8px; padding: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3); cursor: pointer;
      width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;
    }
    .custom-button i { font-size: 18px; color: #444; }
  </style>
</head>
<body>
  <div id="appHeader">Jewish Atlas</div>
  <div id="filterContainer">
    <button class="filterBtn active" data-category="">All</button>
    <button class="filterBtn" data-category="Synagogue">Synagogues</button>
    <button class="filterBtn" data-category="Heritage">Heritage</button>
    <button class="filterBtn" data-category="Kosher Restaurant">Kosher Food</button>
    <button class="filterBtn" data-category="Community">Community</button>
  </div>

  <div id="viewDiv"></div>
  <div id="welcomeModal">
    <div class="modal-content">
      <h2>üåç Explore Jewish Heritage Around the World</h2>
      <p>Use the map to find synagogues, heritage sites, kosher food and more.</p>
      <div class="modal-buttons">
        <button id="startBtn" class="start-button">Start Exploring</button>
        <a href="https://survey123.arcgis.com/share/304788fc266542c19d2f2ccb74cfed39" target="_blank" class="upload-button">Upload Your Site</a>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('startBtn').addEventListener('click', () => {
      document.getElementById('welcomeModal').style.display = 'none';
    });

    function initMap() {
      require([
        "esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer",
        "esri/widgets/Locate", "esri/widgets/Home", "esri/widgets/Search", "esri/widgets/Zoom"
      ], (Map, MapView, FeatureLayer, Locate, Home, Search, Zoom) => {
        const map = new Map({ basemap: 'topo-vector' });
        const view = new MapView({
          container: 'viewDiv', map: map,
          center: [35.21, 31.78], zoom: 7,
          ui: { components: [] }
        });

        const renderer = {
          type: 'unique-value', field: 'main_category',
          defaultSymbol: { type: 'simple-marker', style: 'circle', color: '#aaa', outline: { color: '#fff', width: 1 } },
          uniqueValueInfos: [
            { value: 'Synagogue', symbol: { type: 'simple-marker', style: 'circle', color: '#5DADE2' } },
            { value: 'Heritage',  symbol: { type: 'simple-marker', style: 'circle', color: '#EC7063' } },
            { value: 'Community', symbol: { type: 'simple-marker', style: 'circle', color: '#F5B041' } },
            { value: 'Kosher Restaurant', symbol: { type: 'simple-marker', style: 'circle', color: '#58D68D' } }
          ],
          visualVariables: [{
            type: 'size', valueExpression: '$view.scale',
            stops: [
              { value: 100000000, size: 4 },
              { value: 20000000,  size: 6 },
              { value: 5000000,   size: 8 },
              { value: 1000000,   size: 10 },
              { value: 200000,    size: 12 }
            ]
          }]
        };

        const labelingInfo = [{
          labelExpressionInfo: { expression: "$feature.eng_name" },
          labelPlacement: 'above-center',
          symbol: { type: 'text', color: '#333', haloColor: '#fff', haloSize: 1, font: { size: 12, family: 'Arial', weight: 'bold' } },
          minScale: 15000
        }];

        const popupTemplate = {
          title: '{Name}',
          content: '<p><strong>Category:</strong> {main_category}</p><p><strong>Address:</strong> {Address}</p>'
        };

        const layer = new FeatureLayer({ url: LANDMARKS_URL, renderer: renderer, labelingInfo: labelingInfo, popupTemplate: popupTemplate });
        map.add(layer);

        view.ui.add(new Locate({ view }), 'top-left');
        view.ui.add(new Home({ view }), 'top-left');
        view.ui.add(new Zoom({ view }), 'bottom-right');

        // Image basemap toggle button
        let isImagery = false;
        const imageBtn = document.createElement('div');
        imageBtn.className = 'esri-widget esri-widget--button esri-interactive custom-button';
        imageBtn.title = 'Toggle Imagery Basemap';
        imageBtn.innerHTML = '<i class="fas fa-image"></i>';
        imageBtn.onclick = () => {
          map.basemap = isImagery ? 'topo-vector' : 'hybrid';
          isImagery = !isImagery;
        };
        view.ui.add(imageBtn, { position: 'top-right', index: 2 });

        const search = new Search({ view: view, allPlaceholder: 'Search Jewish Sites...', includeDefaultSources: true, sources: [{ layer: layer, searchFields: ['eng_name'], displayField: 'eng_name', exactMatch: false, outFields: ['*'], name: 'Jewish Landmarks', placeholder: 'e.g., Mikveh Israel' }] });
        view.ui.add(search, 'top-right');

        document.querySelectorAll('.filterBtn').forEach(btn => {
          btn.addEventListener('click', () => {
            document.querySelectorAll('.filterBtn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const cat = btn.dataset.category;
            layer.definitionExpression = cat ? `main_category = '${cat}'` : '';
          });
        });
      });
    }
    initMap();
  </script>

  <!-- Example config.js -->
  <script type="text/plain">
  // config.js (keep this file out of version control)
  const LANDMARKS_URL = "https://services-eu1.arcgis.com/FckSU1kja7wbnBnq/arcgis/rest/services/Landmarks/FeatureServer/0";
  </script>
</body>
</html>
