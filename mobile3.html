<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jewish Sites Map</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
/* Additional styles to make the map look better on mobile */
@media (max-width: 640px) {
  /* Adjust map container height for small screens */
  #map-wrapper {
    height: 60vh !important;
    min-height: 350px !important;
  }
  
  /* Make buttons larger and easier to tap on mobile */
  #fullscreen-toggle {
    padding: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
  
  /* Ensure the map section has appropriate padding */
  #map-section {
    padding: 1rem;
  }
  
  /* Adjust header title for mobile */
  header h1 {
    font-size: 1.5rem;
  }
  
  /* Navigation links more spaced for touch */
  header nav a {
    padding: 6px 10px;
    margin: 0 2px;
  }
}

/* Improved fullscreen mode styling */
.map-fullscreen {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100% !important;
  height: 100% !important;
  max-height: none !important;
  z-index: 9999 !important;
}

/* Styling for custom fullscreen button */
#fullscreen-toggle {
  transition: all 0.2s ease;
  opacity: 0.8;
}

#fullscreen-toggle:hover {
  opacity: 1;
  transform: scale(1.05);
}

/* Fix for Safari viewport height issues */
@supports (-webkit-touch-callout: none) {
  #map-wrapper {
    height: 50vh; /* Use percent of viewport height on iOS */
    max-height: 450px;
  }
}

/* Ensure iframe contents scale properly */
iframe {
  width: 100%;
  height: 100%;
  border: 0;
}
    body { font-family: 'Poppins', sans-serif; }
    
    /* Add styles for the error modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 500px;
      border-radius: 8px;
    }
    
    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .close-button:hover,
    .close-button:focus {
      color: black;
      text-decoration: none;
    }
    
    /* Add styles for mobile-friendly dismissable notification */
    .location-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 320px;
      animation: slideIn 0.3s ease-out;
    }
    
    .location-notification-content {
      padding: 15px;
    }
    
    .location-notification button {
      background-color: #1a4588;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    /* About section custom styles */
    .about-section {
      background-color: #f8fafc;
      border-top: 1px solid #e2e8f0;
    }
    
    .about-card {
      border-left: 4px solid #3b82f6;
      background-color: white;
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-radius: 0 0.5rem 0.5rem 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

<header class="bg-white shadow sticky top-0 z-50 p-4 flex flex-col sm:flex-row justify-between items-center">
  <h1 class="text-xl font-bold text-gray-900">The Jewish Atlas</h1>
  <nav class="flex flex-wrap gap-4 mt-2 sm:mt-0">
    <a href="#map-section" class="text-gray-700 font-medium hover:text-blue-600">Map</a>
    <a href="#about" class="text-gray-700 font-medium hover:text-blue-600">About</a>
  </nav>
</header>

  <section class="text-center py-16 px-6 bg-gradient-to-r from-blue-100 to-white">
    <h2 class="text-3xl font-semibold mb-4 text-gray-900">Explore Jewish Heritage Around the World</h2>
    <p class="max-w-2xl mx-auto text-lg text-gray-600 mb-8">
      Welcome to The Jewish Atlas. Use the map below to find synagogues, cemeteries, kosher restaurants, ghettos, yeshivas,
      and other Jewish heritage sites globally. Each color represents a different type of site.
    </p>
    <div class="flex flex-col sm:flex-row justify-center gap-4">
      <button onclick="document.getElementById('map-section').scrollIntoView({ behavior: 'smooth' })" 
              class="bg-blue-700 text-white px-6 py-2 rounded-md hover:bg-blue-800 transition">
        Go to Map
      </button>
      <button onclick="document.getElementById('upload-section').scrollIntoView({ behavior: 'smooth' })" 
              class="bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600 transition font-semibold">
        Upload Your Jewish Site
      </button>
    </div>
  </section>

  <section class="bg-white py-12 px-6">
    <h3 class="text-2xl font-semibold text-center mb-8 text-gray-800">Map Legend</h3>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 max-w-5xl mx-auto">
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-red-400 inline-block"></span><span>Synagogue</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-teal-400 inline-block"></span><span>Cemetery</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-yellow-300 inline-block"></span><span>Tomb</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-purple-500 inline-block"></span><span>Monument</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-green-400 inline-block"></span><span>Heritage Site</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-orange-400 inline-block"></span><span>Yeshiva</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-pink-400 inline-block"></span><span>School</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-yellow-700 inline-block"></span><span>Jewish Quarter</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-emerald-500 inline-block"></span><span>Mikveh</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-indigo-500 inline-block"></span><span>Museum</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-gray-500 inline-block"></span><span>Ghetto</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-gray-700 inline-block"></span><span>Karaite Site</span></div>
      <div class="flex items-center space-x-3"><span class="w-5 h-5 rounded-full bg-blue-500 inline-block"></span><span>Kosher Restaurant</span></div>
    </div>
    <p class="text-center text-sm text-gray-500 mt-4">
      Tap the locator icon (top-left on the map) to zoom to your current location. If it doesn't work, check your browser and OS location settings.
    </p>
  </section>

  <section id="map-section" class="p-4 bg-white">
  <!-- Map Container with responsive sizing -->
  <div class="rounded-lg shadow-lg overflow-hidden relative">
    <div id="map-wrapper" style="height: 50vh; min-height: 300px; max-height: 450px;" class="w-full relative">
      <div id="loading-indicator" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10 flex flex-col items-center">
        <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-700 rounded-full animate-spin mb-4"></div>
        <p class="text-gray-600">Loading map...</p>
      </div>
      
      <!-- Move button to bottom left -->
      <button id="fullscreen-toggle" class="absolute bottom-4 left-4 z-20 bg-white p-3 rounded-full shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="expand-icon">
          <polyline points="15 3 21 3 21 9"></polyline>
          <polyline points="9 21 3 21 3 15"></polyline>
          <line x1="21" y1="3" x2="14" y2="10"></line>
          <line x1="3" y1="21" x2="10" y2="14"></line>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="collapse-icon hidden">
          <polyline points="4 14 10 14 10 20"></polyline>
          <polyline points="20 10 14 10 14 4"></polyline>
          <line x1="14" y1="10" x2="21" y2="3"></line>
          <line x1="3" y1="21" x2="10" y2="14"></line>
        </svg>
      </button>
      
      <!-- The iframe with modified URL -->
      <iframe id="map-iframe" class="w-full h-full border-none" 
              src="https://jerus.maps.arcgis.com/apps/instant/media/index.html?appid=73dd616bdca34989966d8f1c3f03c502" 
              allow="geolocation"
              title="Jewish Heritage Map"
              onload="hideLoading()"></iframe>
    </div>
  </div>
  
  <!-- Help text -->
  <div class="mt-3 text-center text-sm text-gray-600">
    <p>Use the fullscreen button in the bottom-left corner to expand the map</p>
  </div>
</section>

<style>
  /* Style for our custom fullscreen button */
  #fullscreen-toggle {
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    transition: all 0.2s ease;
    opacity: 0.9;
  }
  
  #fullscreen-toggle:hover {
    transform: scale(1.05);
    opacity: 1;
  }
  
  /* Make fullscreen overlay cover the entire viewport */
  .map-fullscreen-mode {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    max-height: none !important;
    z-index: 9999 !important;
  }
  
  /* Mobile optimization */
  @media (max-width: 640px) {
    #fullscreen-toggle {
      padding: 12px;
      bottom: 12px;
      left: 12px;
    }
  }
</style>

<script>
  // Function to hide loading indicator when map is loaded
  function hideLoading() {
    document.getElementById('loading-indicator').style.display = 'none';
    checkLocationPermission();
  }
  
  // Toggle fullscreen functionality
  document.addEventListener('DOMContentLoaded', function() {
    const mapWrapper = document.getElementById('map-wrapper');
    const fullscreenToggle = document.getElementById('fullscreen-toggle');
    const expandIcon = fullscreenToggle.querySelector('.expand-icon');
    const collapseIcon = fullscreenToggle.querySelector('.collapse-icon');
    
    // Store original styles
    let originalStyles = {
      height: mapWrapper.style.height,
      minHeight: mapWrapper.style.minHeight,
      maxHeight: mapWrapper.style.maxHeight,
      position: mapWrapper.style.position,
      zIndex: mapWrapper.style.zIndex
    };
    
    fullscreenToggle.addEventListener('click', function() {
      if (expandIcon.classList.contains('hidden')) {
        // Exit fullscreen mode
        mapWrapper.classList.remove('map-fullscreen-mode');
        mapWrapper.style.height = originalStyles.height;
        mapWrapper.style.minHeight = originalStyles.minHeight;
        mapWrapper.style.maxHeight = originalStyles.maxHeight;
        mapWrapper.style.position = originalStyles.position;
        mapWrapper.style.zIndex = originalStyles.zIndex;
        
        expandIcon.classList.remove('hidden');
        collapseIcon.classList.add('hidden');
        
        // Re-enable scrolling
        document.body.style.overflow = 'auto';
      } else {
        // Enter fullscreen mode
        // Save current styles first
        originalStyles = {
          height: mapWrapper.style.height,
          minHeight: mapWrapper.style.minHeight,
          maxHeight: mapWrapper.style.maxHeight,
          position: mapWrapper.style.position,
          zIndex: mapWrapper.style.zIndex
        };
        
        // Apply fullscreen styles
        mapWrapper.classList.add('map-fullscreen-mode');
        
        expandIcon.classList.add('hidden');
        collapseIcon.classList.remove('hidden');
        
        // Disable scrolling while in fullscreen
        document.body.style.overflow = 'hidden';
      }
    });
    
    // Exit fullscreen on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && expandIcon.classList.contains('hidden')) {
        fullscreenToggle.click();
      }
    });
  });
  
  // Function to check if location permission is granted
  function checkLocationPermission() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function(position) {
          console.log("Location permission granted");
        },
        function(error) {
          if (error.code === error.PERMISSION_DENIED) {
            showLocationNotification();
          }
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }
  }
  
  // Function to show location notification (if needed)
  function showLocationNotification() {
    const notification = document.createElement("div");
    notification.className = "location-notification";
    notification.innerHTML = `
      <div class="location-notification-content">
        <p><strong>Location access denied</strong></p>
        <p>Please enable location services in your browser settings to use the "Find my location" feature.</p>
        <button onclick="dismissNotification(this)">Close</button>
      </div>
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      if (document.body.contains(notification)) {
        document.body.removeChild(notification);
      }
    }, 10000);
  }
  
  function dismissNotification(buttonElement) {
    const notification = buttonElement.closest('.location-notification');
    if (notification && notification.parentNode) {
      notification.parentNode.removeChild(notification);
    }
  }
</script>
<!-- Add this script to your page for fullscreen functionality -->
<script>
  // Function to hide loading indicator when map is loaded
  function hideLoading() {
    document.getElementById('loading-indicator').style.display = 'none';
    
    // Check location permission once the map is loaded
    checkLocationPermission();
    
    // Try to hide ArcGIS fullscreen buttons via post-load CSS injection
    try {
      const iframe = document.getElementById('map-iframe');
      if (iframe && iframe.contentWindow) {
        // Wait a bit for the iframe content to fully load
        setTimeout(() => {
          const style = document.createElement('style');
          style.textContent = `
            .esri-component.esri-expand.esri-widget.esri-expand--auto { 
              display: none !important; 
            }
            .esri-expand__container.esri-expand__container--expanded {
              display: none !important;
            }
            .esri-fullscreen {
              display: none !important;
            }
          `;
          
          // Try to inject the style into the iframe
          try {
            iframe.contentWindow.document.head.appendChild(style);
          } catch (e) {
            console.log('Could not inject styles due to cross-origin restrictions');
          }
        }, 1500);
      }
    } catch (e) {
      console.log('Error trying to modify iframe content', e);
    }
  }
  
  // Toggle fullscreen functionality
  document.addEventListener('DOMContentLoaded', function() {
    const mapWrapper = document.getElementById('map-wrapper');
    const fullscreenToggle = document.getElementById('fullscreen-toggle');
    const expandIcon = fullscreenToggle.querySelector('.expand-icon');
    const collapseIcon = fullscreenToggle.querySelector('.collapse-icon');
    
    // Store original styles
    let originalStyles = {
      height: mapWrapper.style.height,
      minHeight: mapWrapper.style.minHeight,
      maxHeight: mapWrapper.style.maxHeight,
      position: mapWrapper.style.position,
      zIndex: mapWrapper.style.zIndex
    };
    
    fullscreenToggle.addEventListener('click', function() {
      if (expandIcon.classList.contains('hidden')) {
        // Exit fullscreen mode
        mapWrapper.style.height = originalStyles.height;
        mapWrapper.style.minHeight = originalStyles.minHeight;
        mapWrapper.style.maxHeight = originalStyles.maxHeight;
        mapWrapper.style.position = originalStyles.position;
        mapWrapper.style.zIndex = originalStyles.zIndex;
        mapWrapper.classList.remove('fixed', 'top-0', 'left-0', 'w-full', 'h-full');
        
        expandIcon.classList.remove('hidden');
        collapseIcon.classList.add('hidden');
        
        // Re-enable scrolling
        document.body.style.overflow = 'auto';
      } else {
        // Enter fullscreen mode
        // Save current styles first
        originalStyles = {
          height: mapWrapper.style.height,
          minHeight: mapWrapper.style.minHeight,
          maxHeight: mapWrapper.style.maxHeight,
          position: mapWrapper.style.position,
          zIndex: mapWrapper.style.zIndex
        };
        
        // Apply fullscreen styles
        mapWrapper.style.position = 'fixed';
        mapWrapper.style.top = '0';
        mapWrapper.style.left = '0';
        mapWrapper.style.width = '100%';
        mapWrapper.style.height = '100%';
        mapWrapper.style.maxHeight = 'none';
        mapWrapper.style.zIndex = '9999';
        
        expandIcon.classList.add('hidden');
        collapseIcon.classList.remove('hidden');
        
        // Disable scrolling while in fullscreen
        document.body.style.overflow = 'hidden';
      }
    });
    
    // Exit fullscreen on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && expandIcon.classList.contains('hidden')) {
        fullscreenToggle.click();
      }
    });
  });
  
  // Function to check if location permission is granted
  function checkLocationPermission() {
    // First check if the browser supports geolocation
    if (navigator.geolocation) {
      // Try to get user's location to trigger permission prompt if needed
      navigator.geolocation.getCurrentPosition(
        // Success callback - permission granted
        function(position) {
          console.log("Location permission granted");
          // Optionally, we could do something here when permission is granted
        },
        // Error callback - permission denied or error
        function(error) {
          console.log("Location error:", error.code, error.message);
          
          // Show notification if permission is denied
          if (error.code === error.PERMISSION_DENIED) {
            showLocationNotification();
          }
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }
  }
</script>

<!-- Add this script to your page for fullscreen functionality -->
<script>
  // Function to hide loading indicator when map is loaded
  function hideLoading() {
    document.getElementById('loading-indicator').style.display = 'none';
    
    // Check location permission once the map is loaded
    checkLocationPermission();
  }
  
  // Toggle fullscreen functionality
  document.addEventListener('DOMContentLoaded', function() {
    const mapWrapper = document.getElementById('map-wrapper');
    const fullscreenToggle = document.getElementById('fullscreen-toggle');
    const expandIcon = fullscreenToggle.querySelector('.expand-icon');
    const collapseIcon = fullscreenToggle.querySelector('.collapse-icon');
    
    // Store original styles
    let originalStyles = {
      height: mapWrapper.style.height,
      minHeight: mapWrapper.style.minHeight,
      maxHeight: mapWrapper.style.maxHeight,
      position: mapWrapper.style.position,
      zIndex: mapWrapper.style.zIndex
    };
    
    fullscreenToggle.addEventListener('click', function() {
      if (expandIcon.classList.contains('hidden')) {
        // Exit fullscreen mode
        mapWrapper.style.height = originalStyles.height;
        mapWrapper.style.minHeight = originalStyles.minHeight;
        mapWrapper.style.maxHeight = originalStyles.maxHeight;
        mapWrapper.style.position = originalStyles.position;
        mapWrapper.style.zIndex = originalStyles.zIndex;
        mapWrapper.classList.remove('fixed', 'top-0', 'left-0', 'w-full', 'h-full');
        
        expandIcon.classList.remove('hidden');
        collapseIcon.classList.add('hidden');
        
        // Re-enable scrolling
        document.body.style.overflow = 'auto';
      } else {
        // Enter fullscreen mode
        // Save current styles first
        originalStyles = {
          height: mapWrapper.style.height,
          minHeight: mapWrapper.style.minHeight,
          maxHeight: mapWrapper.style.maxHeight,
          position: mapWrapper.style.position,
          zIndex: mapWrapper.style.zIndex
        };
        
        // Apply fullscreen styles
        mapWrapper.style.position = 'fixed';
        mapWrapper.style.top = '0';
        mapWrapper.style.left = '0';
        mapWrapper.style.width = '100%';
        mapWrapper.style.height = '100%';
        mapWrapper.style.maxHeight = 'none';
        mapWrapper.style.zIndex = '9999';
        
        expandIcon.classList.add('hidden');
        collapseIcon.classList.remove('hidden');
        
        // Disable scrolling while in fullscreen
        document.body.style.overflow = 'hidden';
      }
    });
    
    // Exit fullscreen on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && expandIcon.classList.contains('hidden')) {
        fullscreenToggle.click();
      }
    });
  });
  
  // Function to check if location permission is granted
  function checkLocationPermission() {
    // First check if the browser supports geolocation
    if (navigator.geolocation) {
      // Try to get user's location to trigger permission prompt if needed
      navigator.geolocation.getCurrentPosition(
        // Success callback - permission granted
        function(position) {
          console.log("Location permission granted");
          // Optionally, we could do something here when permission is granted
        },
        // Error callback - permission denied or error
        function(error) {
          console.log("Location error:", error.code, error.message);
          
          // Show notification if permission is denied
          if (error.code === error.PERMISSION_DENIED) {
            showLocationNotification();
          }
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }
  }
</script>
  <!-- About Section (now under the map) -->
  <section id="about" class="about-section py-16 px-6">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-3xl font-semibold mb-8 text-center text-gray-900">About The Jewish Atlas</h2>
      
      <div class="about-card mb-8">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Our Mission</h3>
        <p class="mb-4">
          The Jewish Atlas declares a mission to collect all spatial data on Jewish sites, from the beginning of history until today. The data includes many categories such as synagogues, educational institutions, restaurants, schools, events, family homes, and more.
        </p>
        <p class="mb-4">
          This website serves as the main interface for the Jewish Atlas database. You can use it anywhere to explore and get familiar with Jewish heritage and present-day Jewish life. We need your help to grow — upload your Jewish site and become part of this living archive.
        </p>
      </div>
      
      <div class="grid md:grid-cols-2 gap-6">
        <div class="about-card h-full">
          <h3 class="text-xl font-semibold mb-4 text-gray-800">What We Document</h3>
          <ul class="space-y-2">
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Religious sites (synagogues, mikvehs, yeshivas)</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Cultural and communal centers</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Educational institutions</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Historical landmarks and monuments</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Kosher food establishments</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Ancient and modern residential areas</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Locations of significant historical events</span>
            </li>
          </ul>
        </div>
        
        <div class="about-card h-full">
          <h3 class="text-xl font-semibold mb-4 text-gray-800">Why This Matters</h3>
          <ul class="space-y-2">
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Preserving cultural heritage for future generations</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Supporting educational initiatives and research</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Connecting travelers with Jewish sites globally</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Creating a comprehensive historical record</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Building community through shared knowledge</span>
            </li>
            <li class="flex items-start">
              <span class="text-blue-500 mr-2">•</span>
              <span>Documenting patterns of Jewish life across time</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Custom error modal for location permission issues -->
  <div id="locationErrorModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <h3 class="text-xl font-semibold mb-4">Location Permission Required</h3>
      <p class="mb-4">To use the location features of this map, please:</p>
      <ol class="list-decimal pl-5 mb-4">
        <li>Make sure location services are enabled on your device</li>
        <li>Allow this website to access your location when prompted</li>
        <li>If you previously denied permission, you may need to reset it in your browser settings</li>
      </ol>
      <div class="flex justify-end">
        <button onclick="closeModal()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Got it
        </button>
      </div>
    </div>
  </div>

  <footer class="bg-gray-800 text-white text-center py-6 text-sm">
    &copy; 2025 The Jewish Atlas. All rights reserved.
  </footer>

  <script>
    // Function to hide loading indicator when map is loaded
    function hideLoading() {
      document.getElementById('loading-indicator').style.display = 'none';
      
      // Check location permission once the map is loaded
      checkLocationPermission();
    }
    
    // Function to check if location permission is granted
    function checkLocationPermission() {
      // First check if the browser supports geolocation
      if (navigator.geolocation) {
        // Try to get user's location to trigger permission prompt if needed
        navigator.geolocation.getCurrentPosition(
          // Success callback - permission granted
          function(position) {
            console.log("Location permission granted");
            // Optionally, we could do something here when permission is granted
          },
          // Error callback - permission denied or error
          function(error) {
            console.log("Location error:", error.code, error.message);
            
            // Show notification if permission is denied
            if (error.code === error.PERMISSION_DENIED) {
              showLocationNotification();
            }
          },
          {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
          }
        );
      }
    }
    
    // Function to show location notification
    function showLocationNotification() {
      const notification = document.createElement("div");
      notification.className = "location-notification";
      notification.innerHTML = `
        <div class="location-notification-content">
          <p><strong>Location access denied</strong></p>
          <p>Please enable location services in your browser settings to use the "Find my location" feature.</p>
          <button onclick="dismissNotification(this)">Close</button>
        </div>
      `;
      document.body.appendChild(notification);
      
      // Auto dismiss after 10 seconds
      setTimeout(() => {
        if (document.body.contains(notification)) {
          document.body.removeChild(notification);
        }
      }, 10000);
    }
    
    // Function to dismiss notification
    function dismissNotification(buttonElement) {
      const notification = buttonElement.closest('.location-notification');
      if (notification && notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }
    
    // Script to handle iframe messaging and location permission errors
    window.addEventListener('message', function(event) {
      // Check if the message is from our map iframe and contains a location error
      if (event.data && event.data.type === 'locationError') {
        showLocationErrorModal();
      }
    });

    // Function to show the modal
    function showLocationErrorModal() {
      document.getElementById('locationErrorModal').style.display = 'block';
    }

    // Function to close the modal
    function closeModal() {
      document.getElementById('locationErrorModal').style.display = 'none';
    }

    // Close the modal if the user clicks outside of it
    window.onclick = function(event) {
      let modal = document.getElementById('locationErrorModal');
      if (event.target == modal) {
        modal.style.display = 'none';
      }
    }

    // Ensure the map is loaded over HTTPS
    document.addEventListener('DOMContentLoaded', function() {
      let iframe = document.getElementById('map-iframe');
      let src = iframe.src;
      
      // If the iframe src doesn't start with https, update it
      if (!src.startsWith('https://')) {
        iframe.src = src.replace('http://', 'https://');
      }
    });
  </script>
</body>
</html>