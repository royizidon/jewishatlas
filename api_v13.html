<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jewish Atlas</title>

  <!-- ArcGIS CSS -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
  <!-- ArcGIS JS -->
  <script src="https://js.arcgis.com/4.26/"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>

    /* Base & Layout */
    html, body { margin: 0; padding: 0; height: 100%; font-family: 'Helvetica Neue', sans-serif; background: #f5f5f5; overflow: hidden; }

    /* Header */
    #appHeader { position: fixed; top: 0; left: 0; width: 100%; height: 50px; background: #fff; border-bottom: 1px solid #ddd; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; color: #2c3e50; z-index: 1000; }

    /* Filters */
    #filterContainer { position: fixed; top: 50px; left: 0; width: 100%; background: #fff; padding: 8px 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; gap: 8px; overflow-x: auto; white-space: nowrap; z-index: 1000; }
    .filterBtn { padding: 6px 14px; border: 2px solid #ccc; border-radius: 20px; background: #fff; font-size: 14px; cursor: pointer; color: #555; transition: 0.15s; white-space: nowrap; flex-shrink: 0; text-align: center; }
    .filterBtn.active { background: #555; border-color: #555; color: #fff; }

    /* Search container under filters */
    #searchContainer {
      position: fixed;
      top: 150px; /* header + filters */
      left: 0; right: 0;
      padding: 8px 10px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      z-index: 1001;
      text-align: center;
    }
    #searchContainer .esri-search {
      width: 90vw !important;
      min-width: 250px !important;
      margin: 0 auto !important;
      box-shadow: none !important;
    }

    /* Map occupies rest of screen */
#viewDiv {
  position: absolute;
  top: 94px; /* üëà Change this to match total space above the map */
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1;
}


    /* Modal */
    #welcomeModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 2000; animation: fadeIn 0.5s ease-out; }
    .modal-content { background: #fff; padding: 30px 25px; border-radius: 14px; max-width: 500px; text-align: center; box-shadow: 0 6px 20px rgba(0,0,0,0.3); animation: popUp 0.4s ease; }
    .modal-buttons { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-top: 20px; }
    .start-button, .upload-button { flex: 1 1 45%; min-width: 140px; padding: 12px 18px; font-size: 16px; border-radius: 30px; font-weight: bold; text-align: center; border: none; box-shadow: 0 2px 6px rgba(0,0,0,0.2); transition: 0.2s; }
    .start-button { background: #2D66F4; color: #fff; }
    .start-button:hover { background: #1741b3; }
    .upload-button { background: #F57C00; color: #fff; text-decoration: none !important; }
    .upload-button:hover { background: #d45e00; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popUp { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    /* Widget spacing */
    .esri-widget { margin: 6px !important; }
    .custom-button { background: #fff; border-radius: 8px; padding: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
    .custom-button span { font-size: 18px; }

    /* Category colors */
    .category-synagogue { background: #5DADE2; border-color: #5DADE2; color: #fff; }
    .category-heritage  { background: #EC7063; border-color: #EC7063; color: #fff; }
    .category-community{ background: #F5B041; border-color: #F5B041; color: #fff; }
    .category-kosher   { background: #58D68D; border-color: #58D68D; color: #fff; }
    .category-all      { background: #ccc;   border-color: #ccc;   color: #fff; }

    /* Responsive tweaks */
    @media (max-width: 768px) { .filterBtn { font-size: 13px; padding: 5px 12px; } }
    @media (max-width: 480px) { #appHeader { font-size: 16px; padding: 0 10px; } .filterBtn { font-size: 12px; padding: 4px 10px; } }
  </style>
</head>
<body>
  <div id="appHeader">Jewish Atlas</div>
  <div id="filterContainer">
    <button class="filterBtn active category-all" data-category="">All</button>
    <button class="filterBtn category-synagogue" data-category="Synagogue">Synagogues</button>
    <button class="filterBtn category-heritage" data-category="Heritage">Heritage</button>
    <button class="filterBtn category-kosher" data-category="Kosher Restaurant">Kosher Food</button>
    <button class="filterBtn category-community" data-category="Community">Community</button>
  </div>
  
  <!-- Search bar container under filters -->
 <!-- <div id="searchContainer"></div> -->

  <div id="viewDiv"></div>

  <div id="welcomeModal">
    <div class="modal-content">
      <h2>üåç Explore Jewish Heritage Around the World</h2>
      <p>Use the map to find synagogues, heritage sites, kosher food and more ‚Äî or contribute your own site.</p>
      <div class="modal-buttons">
        <button onclick="closeModal()" class="start-button">Start Exploring</button>
        <a href="https://survey123.arcgis.com/share/304788fc266542c19d2f2ccb74cfed39" target="_blank" class="upload-button">Upload Your Jewish Site</a>
      </div>
    </div>
  </div>

  <script>
    function closeModal() { document.getElementById('welcomeModal').style.display = 'none'; }

    require([
      "esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer",
      "esri/widgets/Locate", "esri/widgets/Home", "esri/widgets/Search"
    ], function(Map, MapView, FeatureLayer, Locate, Home, Search) {
      const map = new Map({ basemap: 'topo-vector' });
      const view = new MapView({ container: 'viewDiv', map: map, center: [35.21,31.78], zoom: 7, padding: { top: 138 }, ui: { padding: { top: 138 } }, popup: { dockEnabled: true, dockOptions: { position: 'top', buttonEnabled: false, breakpoint: false } } });
view.ui.move("zoom", "bottom-right"); 
      const landmarks = new FeatureLayer({
        url: 'https://services-eu1.arcgis.com/FckSU1kja7wbnBnq/arcgis/rest/services/Landmarks/FeatureServer/0',
        popupTemplate: {
          title: '<div class="popup-title">{Name}</div>',
          content: `
            <div class="popup-card">
              <div class="popup-category">{Category}</div>
              <div class="popup-address">{Address}</div>
              <div class="popup-buttons">
                <a href="https://www.google.com/maps/search/?api=1&query={lat},{lon}" target="_blank" class="popup-button"><span class="icon">üìç</span>View on Google Maps</a>
                <a href="https://waze.com/ul?ll={lat},{lon}&navigate=yes" target="_blank" class="popup-button"><span class="icon">üöó</span>Navigate on Waze</a>
              </div>
            </div>
          `
        },
        renderer: {
          type: 'unique-value', field: 'main_category', defaultSymbol: { type: 'simple-marker', color: 'gray', outline: { color: 'white', width: 1 } },
          uniqueValueInfos: [
            { value: 'Synagogue', symbol: { type: 'simple-marker', color: '#5DADE2', outline: { color: 'white', width: 1 } } },
            { value: 'Heritage',  symbol: { type: 'simple-marker', color: '#EC7063', outline: { color: 'white', width: 1 } } },
            { value: 'Community', symbol: { type: 'simple-marker', color: '#F5B041', outline: { color: 'white', width: 1 } } },
            { value: 'Kosher Restaurant', symbol: { type: 'simple-marker', color: '#58D68D', outline: { color: 'white', width: 1 } } }
          ],
          visualVariables: [{ type: 'size', valueExpression: '$view.scale', stops: [
            { value: 50000000, size: 2 },
            { value: 25000000, size: 3 },
            { value: 10000000, size: 4 },
            { value: 5000000,  size: 5 },
            { value: 1000000,  size: 6 },
            { value: 500000,   size: 7 },
            { value: 70000,    size: 7 },
            { value: 60000,    size: 8 },
            { value: 40000,    size: 9 },
            { value: 20000,    size: 11 }
          ]}]
        },
        labelingInfo: [{
          labelExpressionInfo: { expression: '$feature.eng_name' },
          labelPlacement: 'above-center',
          symbol: { type: 'text', color: 'black', haloColor: 'white', haloSize: 1, font: { family: 'Arial', size: 10, weight: 'bold' } },
          minScale: 10000, maxScale: 0
        }]
      });
      map.add(landmarks);

      // widgets
      view.ui.add(new Locate({ view }), { position: 'top-left' });
      view.ui.add(new Home({ view }),   { position: 'top-left' });
      const refreshBtn = document.createElement('div');
      refreshBtn.className = 'esri-widget esri-widget--button esri-interactive custom-button';
      refreshBtn.title = 'Refresh Page';
      refreshBtn.innerHTML = '<span>üîÑ</span>';
      refreshBtn.onclick = () => location.reload();
      view.ui.add(refreshBtn, { position: 'top-right' });
      const toggleBtn = document.createElement('div');
      toggleBtn.className = 'esri-widget esri-widget--button esri-interactive custom-button';
      toggleBtn.title = 'Toggle Imagery Basemap';
      toggleBtn.innerHTML = '<i class="fas fa-layer-group"></i>';
      let isImagery = false;
      toggleBtn.onclick = () => { map.basemap = isImagery ? 'topo-vector' : 'hybrid'; isImagery = !isImagery; };
      view.ui.add(toggleBtn, { position: 'top-right' });

      // Create the Search widget (do not set the container)
const searchWidget = new Search({
  view: view,
  allPlaceholder: 'Search',
  includeDefaultSources: true,
  sources: [
    {
      layer: landmarks,
      searchFields: ['eng_name'],
      displayField: 'eng_name',
      exactMatch: false,
      outFields: ['*'],
      name: 'Jewish Landmarks',
      placeholder: 'e.g., Mikveh Israel'
    }
  ]
});

// Add the search widget to the map UI (top-right, but you can pick any corner)
view.ui.add(searchWidget, { position: 'bottom-left', index: 0 });

      // filter
      document.querySelectorAll('.filterBtn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filterBtn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const cat = btn.getAttribute('data-category');
          landmarks.definitionExpression = cat ? `main_category = '${cat}'` : '';
        });
      });
    });
  </script>
</body>
</html>
