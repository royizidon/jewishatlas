<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Jewish Atlas</title>

  <!-- ArcGIS CSS & JS -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.26/"></script>

  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    html, body { margin: 0; padding: 0; height: 100%; font-family: 'Helvetica Neue', sans-serif; background: #f5f5f5; overflow: hidden; }

    /* Header */
    #appHeader { position: fixed; top: 0; left: 0; width: 100%; height: 50px; background: #fff; border-bottom: 1px solid #ddd; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; color: #2c3e50; z-index: 1000; }

    /* Filter bar */
    #filterContainer { position: fixed; top: 50px; left: 0; width: 100%; background: #fff; padding: 8px 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; gap: 8px; overflow-x: auto; white-space: nowrap; z-index: 1000; }
    .filterBtn { padding: 6px 14px; border: 2px solid #ccc; border-radius: 20px; background: #fff; font-size: 14px; cursor: pointer; color: #555; transition: 0.15s; white-space: nowrap; flex-shrink: 0; text-align: center; }
    .filterBtn.active { background: #555; border-color: #555; color: #fff; }

    /* Map container */
    #viewDiv { position: absolute; top: 94px; left: 0; right: 0; bottom: 0; z-index: 1; }

    /* Floating Action Button (FAB) stack for tools) */
    #fabStack { position: absolute; bottom: 20px; right: 15px; display: flex; flex-direction: column; gap: 10px; z-index: 1001; }
    .fab-btn {
      background: white; border: 1px solid #ccc; border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25); width: 48px; height: 48px;
      display: flex; align-items: center; justify-content: center; font-size: 20px;
      color: #333; cursor: pointer; transition: transform 0.2s ease, background 0.2s;
    }
    .fab-btn:hover { background: #f0f0f0; transform: scale(1.05); }

    /* Responsive Tweaks */
    @media (max-width: 600px) {
      #fabStack { bottom: 12px; right: 10px; }
      .fab-btn { width: 44px; height: 44px; font-size: 18px; }
    }
  </style>
</head>
<body>
  <!-- Header and filters -->
  <div id="appHeader">Jewish Atlas</div>
  <div id="filterContainer">
    <button class="filterBtn active category-all" data-category="">All</button>
    <button class="filterBtn category-synagogue" data-category="Synagogue">Synagogues</button>
    <button class="filterBtn category-heritage" data-category="Heritage">Heritage</button>
    <button class="filterBtn category-kosher" data-category="Kosher Restaurant">Kosher Food</button>
    <button class="filterBtn category-community" data-category="Community">Community</button>
  </div>

  <!-- Map div -->
  <div id="viewDiv"></div>

  <!-- Floating button stack -->
  <div id="fabStack">
    <div id="refreshBtn" class="fab-btn" title="Refresh"><span>ðŸ”„</span></div>
    <div id="toggleBtn" class="fab-btn" title="Toggle Basemap"><i class="fas fa-layer-group"></i></div>
  </div>

  <script>
    require([
      "esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer",
      "esri/widgets/Search", "esri/widgets/Home", "esri/widgets/Locate", "esri/widgets/Zoom"
    ], function(Map, MapView, FeatureLayer, Search, Home, Locate, Zoom) {

      const map = new Map({ basemap: 'topo-vector' });

      const view = new MapView({
        container: 'viewDiv',
        map: map,
        center: [35.21, 31.78],
        zoom: 7,
        popup: {
          dockEnabled: true,
          dockOptions: { position: 'top', buttonEnabled: false, breakpoint: false }
        }
      });

      const landmarks = new FeatureLayer({
        url: 'https://services-eu1.arcgis.com/FckSU1kja7wbnBnq/arcgis/rest/services/Landmarks/FeatureServer/0',
        popupTemplate: {
          title: '{Name}',
          content: `
            <strong>Category:</strong> {Category}<br>
            <strong>Address:</strong> {Address}<br>
            <a href="https://www.google.com/maps/search/?api=1&query={lat},{lon}" target="_blank">Google Maps</a> |
            <a href="https://waze.com/ul?ll={lat},{lon}&navigate=yes" target="_blank">Waze</a>`
        },
        renderer: {
          type: 'unique-value',
          field: 'main_category',
          uniqueValueInfos: [
            { value: 'Synagogue', symbol: { type: 'simple-marker', color: '#5DADE2' } },
            { value: 'Heritage', symbol: { type: 'simple-marker', color: '#EC7063' } },
            { value: 'Community', symbol: { type: 'simple-marker', color: '#F5B041' } },
            { value: 'Kosher Restaurant', symbol: { type: 'simple-marker', color: '#58D68D' } }
          ]
        }
      });
      map.add(landmarks);

      // Add search (landmarks + default sources)
      const searchWidget = new Search({
        view: view,
        allPlaceholder: 'Search Jewish Sites...',
        includeDefaultSources: true,
        sources: [{
          layer: landmarks,
          searchFields: ['eng_name'],
          displayField: 'eng_name',
          outFields: ['*'],
          name: 'Jewish Landmarks',
          placeholder: 'e.g., Mikveh Israel'
        }]
      });
      view.ui.add(searchWidget, { position: 'top-left' });

      // Add built-in widgets manually to stack
      const homeWidget = new Home({ view });
      const locateWidget = new Locate({ view });
      const zoomWidget = new Zoom({ view });

      view.ui.add(homeWidget, { position: 'manual' });
      view.ui.add(locateWidget, { position: 'manual' });
      view.ui.add(zoomWidget, { position: 'manual' });

      document.getElementById('fabStack').appendChild(homeWidget.container);
      document.getElementById('fabStack').appendChild(locateWidget.container);
      document.getElementById('fabStack').appendChild(zoomWidget.container);

      // Refresh functionality
      document.getElementById("refreshBtn").onclick = () => location.reload();

      // Toggle basemap
      let isImagery = false;
      document.getElementById("toggleBtn").onclick = () => {
        map.basemap = isImagery ? "topo-vector" : "hybrid";
        isImagery = !isImagery;
      };

      // Filter buttons
      document.querySelectorAll('.filterBtn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filterBtn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const cat = btn.getAttribute('data-category');
          landmarks.definitionExpression = cat ? `main_category = '${cat}'` : '';
        });
      });
    });
  </script>
</body>
</html>
